#!/bin/bash

POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon") 
OUTPUT_DIR="Advanced_shell" 
ERROR_LOG="parallel_errors.txt"

mkdir -p "$OUTPUT_DIR"
:> "$ERROR_LOG"  # Clear previous error log

fetch_pokemon() {
    pokemon="$1"
    API_URL="https://pokeapi.co/api/v2/pokemon/$pokemon"
    OUTPUT_FILE="$OUTPUT_DIR/$pokemon.json"
    
    echo "Fetching data for $pokemon ..."
    
    status_code=$(curl -s -w "%{http_code}" "$API_URL" -o "$OUTPUT_FILE")
    if [ "$status_code" -eq 200 ]; then
        echo "Saved data for $OUTPUT_FILE"
    else
        echo "[$(date)] Failed to fetch data for $pokemon. Status code: $status_code" >> "$ERROR_LOG"
        rm -f "$OUTPUT_FILE"  # Remove incomplete output file
    fi
}

for pokemon in "${POKEMON_LIST[@]}"; do
    fetch_pokemon "$pokemon" &
done

wait  # Wait for all background processes to finish

echo "Active background jobs: $(jobs -r | wc -l)"
wait 

echo "All jobs completed."

dummy_sleep() {
    sleep 1
}
dummy_sleep &
DUMMY_PID=$!

kill -0 $DUMMY_PID 2>/dev/null